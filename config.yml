customCommands:
  - name: üìù Compose edit
    command: micro $COMPOSE_FILE
    attach: false
  - name: ‚öôÔ∏è ENV edit
    command: find $(dirname $COMPOSE_FILE) -maxdepth 1 -iname *env* | head -n 1 | xargs micro
    attach: false
  - name: üëÅÔ∏è ENV view
    command: docker-compose exec $COMPOSE_SERVICE_NAME env
    attach: true
  - name: üîº Up stack
    command: docker-compose up -d
    attach: true
  - name: üîª Down stack
    command: docker-compose down
    attach: true
  - name: ‚ôªÔ∏è Recreate stack
    command: docker-compose up -d --force-recreate
    attach: true
  - name: üîÑ Restart container
    command: docker-compose restart $COMPOSE_SERVICE_NAME
    attach: true
  - name: ‚èπÔ∏è Stop container
    command: docker-compose stop $COMPOSE_SERVICE_NAME
    attach: true
  - name: üîç Logs fuzzy
    command: docker logs $COMPOSE_SERVICE_NAME --follow --timestamps 2>&1 | tspin | fzf --reverse --bind "result:last"
    attach: false
  - name: üéØ Logs exact
    command: docker logs $COMPOSE_SERVICE_NAME --follow --timestamps 2>&1 | tspin | fzf --reverse --bind "result:last" --exact
    attach: false
  - name: üí° Logs regex
    command: |
      echo "" | fzf --reverse --bind "result:last" --disabled \
      --bind "start:reload(docker  logs $COMPOSE_SERVICE_NAME --timestamps 2>&1 | tspin | rg --smart-case --color=always {q})" \
      --bind "change:reload(docker logs $COMPOSE_SERVICE_NAME --timestamps 2>&1 | tspin | rg --smart-case --color=always {q} || echo '‚ö†Ô∏è Invalid regex pattern')"
    attach: false
  - name: "{} Logs json"
    command: docker logs $COMPOSE_SERVICE_NAME --follow 2>&1 | while read -r line; do echo $line | jq -cC; done | fzf --reverse --bind "result:last" --exact
    attach: false
  - name: $_ Sh
    command: docker-compose exec $COMPOSE_SERVICE_NAME 'sh'
    attach: false
  - name: üîë Bash root
    command: docker-compose exec -u root $COMPOSE_SERVICE_NAME 'bash'
    attach: false
  - name: üìä top
    command: docker-compose top
    attach: true
  - name: üèîÔ∏è Alpine htop
    command: docker-compose exec $COMPOSE_SERVICE_NAME sh -c 'apk add htop && htop'
    attach: false
  - name: üåÄ Debian htop
    command: docker-compose exec $COMPOSE_SERVICE_NAME sh -c 'apt install -y htop && htop'
    attach: false
  - name: üåê Web links
    command: IP=$(hostname -I | awk '{print $1}'); docker port $COMPOSE_SERVICE_NAME | awk -F ':' -v ip="$IP" '$2!="" {print "http://"ip":"$2}' | sort -u
    attach: true
  - name: üè∑Ô∏è Inspect config labels
    command: |
      echo "" | fzf --reverse --disabled --query ".[].Config.Labels" \
      --bind "start:reload(docker inspect $COMPOSE_SERVICE_NAME | jq -C {q})" \
      --bind "change:reload(docker inspect $COMPOSE_SERVICE_NAME | jq -C {q} || echo -e '‚ö†Ô∏è Invalid query filter')"
    attach: false
  - name: üìÇ Diff files
    command: |
      clear && docker diff $COMPOSE_SERVICE_NAME | sed \
      -e "s/^A /$(printf '\033[32mA\033[0m ')/" \
      -e "s/^C /$(printf '\033[33mC\033[0m ')/" \
      -e "s/^D /$(printf '\033[31mD\033[0m ')/"
    attach: true
  - name: üìã Copy files
    command: |
      docker cp $COMPOSE_SERVICE_NAME:$FILE ./
      FILES=$(docker-compose exec $COMPOSE_SERVICE_NAME find / -type f | fzf --reverse --multi --exact)
      if [ -n "$FILES" ]; then
          echo "$FILES" | while read -r FILE; do
              docker cp $COMPOSE_SERVICE_NAME:"$FILE" ./
          done
      fi && read
    attach: false
  - name: üê≥ Dockerfile edit
    command: find $(dirname $COMPOSE_FILE) -maxdepth 1 -iname *dockerfile* | head -n 1 | xargs micro
    attach: false
  - name: üî® Build image
    command: docker-compose up -d --force-recreate --build $COMPOSE_SERVICE_NAME
    attach: true
  - name: üìÆ Images delete
    command: |
      docker images --all | { 
        read -r header
        fzf --header="$header" --reverse --multi --exact --preview 'docker image inspect {3} | jq -C .[]'
      } | awk '{print $1":"$2}' | {
        images=$(cat)
        [ -z "$images" ] && exit 0
        read -p "‚ö†Ô∏è Enter Y for delete $(echo "$images" | xargs) images: " DELETE_IMAGES < /dev/tty
          if [[ "$DELETE_IMAGES" == "Y" ]]; then
            echo "$images" | xargs docker rmi
          fi
      } && read
    attach: false
  - name: üì• Images update
    command: docker-compose pull
    attach: true
  - name: üì¶ Image history
    command: docker history $COMPOSE_IMAGE_NAME
    attach: true
  - name: üíæ Image save
    command: docker save $COMPOSE_IMAGE_NAME | dd status=progress | gzip > $(echo $COMPOSE_IMAGE_NAME | sed -r "s/\/|:/-/g").tar.gz && ls -lh *.tar.gz
    attach: true
  - name: ‚òÅÔ∏è Docker Hub tags
    command: |
      replaceTag=$(echo $COMPOSE_IMAGE_NAME | sed -r "s/:.+//")
      (printf "DATE TIME TAG\n"; \
      curl -sSL "https://registry.hub.docker.com/v2/repositories/${replaceTag}/tags?page_size=100" | \
      jq -r '.results[] | "\(.last_updated|sub("\\..*";"")|sub("T";" ")) \(.name)"') | column -t
    attach: true
  - name: ‚ûï Create project
    command: |
      read -p "üí° Enter name for new project: " NEW_PROJECT_NAME
      if [[ -n "$NEW_PROJECT_NAME" ]]; then
        export COMPOSE_PROJECT_NAME=$NEW_PROJECT_NAME
        export COMPOSE_FILE="$COMPOSE_PATH/$COMPOSE_PROJECT_NAME/docker-compose.yml"
        mkdir -p "$COMPOSE_PATH/$COMPOSE_PROJECT_NAME"
        touch $COMPOSE_FILE
        micro $COMPOSE_FILE
      fi
    attach: false
  - name: üóëÔ∏è Delete project
    command: |
      read -p "‚ö†Ô∏è Enter Y for delete $COMPOSE_PROJECT_NAME project: " DELETE_PROJECT
      if [[ "$DELETE_PROJECT" == "Y" ]]; then
        docker-compose down --volumes
        rm -rf $(dirname $COMPOSE_FILE)
      fi
    attach: false